# 2.3.8 Funktionalität im Zusammenhang mit Datenbanken realisieren

<html>
<head>
<style>
h1, h2, h3 {
  border-bottom: 2px solid #444;
  padding-bottom: 4px;
  margin-top: 30px;
}
code, pre {
  background: #f4f4f4;
  padding: 6px 10px;
  border-radius: 6px;
  font-family: "Consolas", monospace;
  color: #222;
}
ul {
  list-style-type: square;
  margin-left: 20px;
}
blockquote {
  border-left: 4px solid #888;
  padding-left: 10px;
  color: #333;
  font-style: italic;
}
table {
  border-collapse: collapse;
  width: 100%;
  margin: 10px 0;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
}
th {
  background-color: #f0f0f0;
}
</style>
</head>
<body>


<h2>Grundlagen</h2>
<ul>
  <li>Programme können Daten aus <strong>Datenbanken</strong> lesen und schreiben.</li>
  <li>Dazu wird eine <strong>Datenbankschnittstelle</strong> (API) genutzt, über die eine Verbindung aufgebaut wird.</li>
  <li>Beispiele: <strong>ODBC</strong>, <strong>JDBC</strong>, <strong>ADO</strong>, <strong>ADO.NET</strong>.</li>
  <li>Die Schnittstelle regelt Authentifizierung, Datenaustausch und Befehlsausführung (SQL).</li>
</ul>

<h2>1. Datenbankschnittstellen</h2>

<table>
  <tr><th>Schnittstelle</th><th>Beschreibung</th></tr>
  <tr><td><strong>ODBC</strong> (Open Database Connectivity)</td><td>Standardisierte, systemunabhängige Datenbank-API. Zugriff auf beliebige Datenbanken über ODBC-Treiber.</td></tr>
  <tr><td><strong>JDBC</strong> (Java Database Connectivity)</td><td>API für Java. Ermöglicht SQL-Abfragen und Updates. Für jede Datenbank ist ein JDBC-Treiber notwendig.</td></tr>
  <tr><td><strong>ADO.NET</strong></td><td>.NET-Technologie von Microsoft. Datenzugriff über Komponenten, z. B. auf SQL Server oder MySQL.</td></tr>
  <tr><td><strong>ADO</strong></td><td>ActiveX-basierte ältere Schnittstelle, auch ohne SQL-Kenntnisse nutzbar, unterstützt aber SQL-Befehle.</td></tr>
</table>

<h2>2. Datenbankverbindung herstellen</h2>

<p>Zur Nutzung einer Datenbank ist eine Verbindung erforderlich. Dafür werden Anmeldeinformationen und eine URL übergeben.</p>

<pre><code>import java.sql.*;

public class Program {
  public static void main(String[] args) {
    final String JDBC_DRIVER = "com.mysql.jdbc.Driver";
    final String URL = "jdbc:mysql://localhost/";
    final String USER = "benutzername";
    final String PASSWORD = "passwort";
    Connection con = null;

    try {
      Class.forName(JDBC_DRIVER); // Treiber registrieren
      System.out.println("Datenbankverbindung wird hergestellt...");
      con = DriverManager.getConnection(URL, USER, PASSWORD);
      System.out.println("Datenbankverbindung erfolgreich hergestellt!");
    } catch (Exception e) {
      e.printStackTrace();
    } finally {
      try {
        if (con != null) con.close();
        System.out.println("Datenbank wurde geschlossen!");
      } catch (Exception e) {}
    }
  }
}
</code></pre>

<h3>Connection Pooling</h3>
<p>Um Leistung zu verbessern, wird ein <strong>Connection Pool</strong> verwendet. Dabei bleiben Verbindungen offen und werden von mehreren Clients wiederverwendet.</p>

<ul>
  <li>Reduziert die Kosten des ständigen Öffnens und Schließens von Verbindungen.</li>
  <li>Geeignet für skalierbare Anwendungen mit vielen Zugriffen.</li>
  <li>Weniger geeignet, wenn viele Leerlaufverbindungen Ressourcen blockieren.</li>
</ul>

<blockquote>
Das Diagramm zeigt: Offene Verbindungen werden dynamisch Clients zugewiesen und nach Nutzung wieder freigegeben.
</blockquote>

<h2>3. SQL zur Datenbankinteraktion</h2>

<h3>Wichtige SQL-Befehle (Überblick)</h3>
<table>
  <tr><th>Kategorie</th><th>Befehle</th><th>Beschreibung</th></tr>
  <tr><td>Datenbanken & Nutzer</td><td><code>CREATE/DROP DATABASE</code>, <code>CREATE/DROP USER</code>, <code>GRANT/REVOKE</code></td><td>Anlegen, Löschen und Rechteverwaltung.</td></tr>
  <tr><td>Tabellen</td><td><code>CREATE/ALTER/DROP TABLE</code></td><td>Tabellenstruktur anlegen oder ändern.</td></tr>
  <tr><td>Daten</td><td><code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>SELECT</code></td><td>Daten einfügen, ändern, löschen und abfragen.</td></tr>
  <tr><td>Verknüpfungen</td><td><code>INNER JOIN</code>, <code>LEFT JOIN</code>, <code>RIGHT JOIN</code>, <code>FULL JOIN</code></td><td>Tabellen über Schlüssel verbinden.</td></tr>
  <tr><td>Operatoren</td><td><code>AND</code>, <code>OR</code>, <code>LIKE</code>, <code>IS NULL</code></td><td>Bedingungen und Filter für Abfragen.</td></tr>
  <tr><td>Aggregation</td><td><code>MIN</code>, <code>MAX</code>, <code>AVG</code>, <code>SUM</code>, <code>COUNT</code></td><td>Statistische Berechnungen.</td></tr>
</table>

<h3>Java – SQL-Anweisungen ausführen</h3>
<pre><code>public void updateDB(String sql) {
  try {
    sqlStatement.executeUpdate(sql);  // INSERT, UPDATE, DELETE
  } catch (SQLException e) {
    e.printStackTrace();
  }
}

public ResultSet getData(String sql) {
try {
return sqlStatement.executeQuery(sql);  // SELECT-Abfrage
} catch (SQLException e) {
e.printStackTrace();
return null;
}
} </code></pre>

<h2>4. Transaktionen</h2>

<ul>
  <li>Eine Transaktion ist eine logische Einheit von mehreren SQL-Operationen.</li>
  <li>Sie wird <strong>entweder vollständig ausgeführt (COMMIT)</strong> oder <strong>komplett rückgängig gemacht (ROLLBACK)</strong>.</li>
  <li>Gewährleistet Datenkonsistenz bei Mehrbenutzerzugriffen.</li>
</ul>

<h3>SQL-Befehle für Transaktionen</h3>
<table>
  <tr><th>Befehl</th><th>Beschreibung</th></tr>
  <tr><td><code>BEGIN</code> / <code>START TRANSACTION</code></td><td>Startet eine neue Transaktion</td></tr>
  <tr><td><code>COMMIT</code></td><td>Speichert Änderungen dauerhaft</td></tr>
  <tr><td><code>ROLLBACK</code></td><td>Macht Änderungen rückgängig</td></tr>
</table>

<h3>Beispiel:</h3>
<pre><code>START TRANSACTION;
INSERT INTO Artikel (Name, Preis) VALUES ('Ansichtskarte', 1.25);
DELETE FROM Artikel WHERE Artikel.ID = 712;
COMMIT;
</code></pre>

<h3>Transaktionen mit JDBC</h3>
<pre><code>Connection con = DriverManager.getConnection(URL, USER, PASSWORD);
try {
  con.setAutoCommit(false); // Automatisches Commit deaktivieren
  PreparedStatement ps1 = con.prepareStatement("INSERT INTO Artikel(Name, Preis) VALUES ('Karte', 1.25)");
  ps1.executeUpdate();
  PreparedStatement ps2 = con.prepareStatement("DELETE FROM Artikel WHERE Artikel.ID = 712");
  ps2.executeUpdate();
  con.commit(); // Änderungen dauerhaft speichern
} catch (Exception e) {
  con.rollback(); // Bei Fehler: alles rückgängig machen
}
</code></pre>

<h2>5. Stored Procedures und Trigger</h2>

<ul>
  <li><strong>Stored Procedures:</strong> gespeicherte Unterprogramme in der Datenbank.</li>
  <li>Beinhaltet mehrere SQL-Befehle, ggf. mit Bedingungen und Schleifen.</li>
  <li><strong>Trigger:</strong> spezielle Stored Procedures, die automatisch bei Ereignissen (z. B. INSERT) ausgelöst werden.</li>
</ul>

<h3>Beispiel – Stored Procedure</h3>
<pre><code>CREATE PROCEDURE ErmittleOrte @Landname VARCHAR(50)
AS
SELECT Land.Name, Ort.Name
FROM Ort
INNER JOIN Land ON Ort.LandID = Land.LandID
WHERE Land.Name = @Landname;
</code></pre>
<pre><code>EXECUTE ErmittleOrte('Deutschland');
</code></pre>

<h3>Stored Procedure löschen</h3>
<pre><code>DROP PROCEDURE ErmittleOrte;
</code></pre>

<h2>Zusammenfassung – Prüfungsrelevant</h2>
<table>
  <tr><th>Thema</th><th>Kernaussage</th></tr>
  <tr><td>ODBC</td><td>Standardisierte, systemunabhängige Datenbankschnittstelle.</td></tr>
  <tr><td>Connection Pool</td><td>Sammlung offener Datenbankverbindungen zur Leistungssteigerung.</td></tr>
  <tr><td>Transaktion</td><td>Fasst mehrere SQL-Befehle logisch zusammen, COMMIT/ROLLBACK sichern Konsistenz.</td></tr>
  <tr><td>Stored Procedure</td><td>Gespeicherte Prozedur mit SQL-Befehlen, kann Bedingungen enthalten.</td></tr>
  <tr><td>Trigger</td><td>Automatisch ausgelöste Prozeduren bei Datenbankereignissen.</td></tr>
</table>

<h3>Kompetenzcheck (richtige Aussagen)</h3>
<ul>
  <li>a) ✔️ ODBC ist eine standardisierte Datenbankschnittstelle.</li>
  <li>b) ✔️ Ein Connection Pool hält Verbindungen offen für Effizienz.</li>
  <li>c) ❌ Eine Transaktion ist keine einzelne SQL-Anweisung, sondern eine Befehlsfolge.</li>
  <li>d) ✔️ Mit <code>BEGIN</code> wird eine Transaktion gestartet.</li>
  <li>e) ✔️ <code>COMMIT</code> und <code>ROLLBACK</code> gehören zu Transaktionen.</li>
  <li>f) ✔️ JDBC behandelt standardmäßig jede SQL-Anweisung als einzelne Transaktion (Auto-Commit).</li>
  <li>g) ❌ Stored Procedures sind nicht dasselbe wie Trigger.</li>
  <li>h) ✔️ Stored Procedures können Bedingungen und Verzweigungen enthalten.</li>
</ul>

</body>
</html>


