# 🧠 3.7.4 Das Basiswissen über SQL erweitern und anwenden [Seite: 275]

Ziel dieses Abschnitts ist, das vorhandene **SQL-Grundwissen** gezielt zu **erweitern** – insbesondere bei **Abfragen über mehrere Tabellen**, dem **Kombinieren von Ergebnismengen**, **Unterabfragen** sowie der **Rechtevergabe**. Als durchgängiges Beispiel dient das relationale Modell **„Ortsverwaltung“** mit den Tabellen **Ort**, **Land** und **Kontinent**. 

| **Begriff** | **Definition / typische Anweisungen**                                                                                                                 |
| ----------- | ----------------------------------------------------------------------------------------------------------------------------------------------------- |
| **DDL**     | **CREATE/DROP DATABASE**, **CREATE/ALTER/DROP TABLE** – Strukturen anlegen/ändern/löschen.                                                            |
| **DML**     | **INSERT**, **UPDATE**, **DELETE** – Daten einfügen/ändern/löschen.                                                                                   |
| **DQL**     | **SELECT** mit **WHERE**, **ORDER BY**, **GROUP BY**, **Aggregaten** (**SUM**, **COUNT**, **AVG**, **MIN**, **MAX**), **LIKE**, Umgang mit **NULL**.  |

## 🔗 Abfragen über mehrere Tabellen (JOINs)

* **Zwei Varianten**:

  1. „klassisch“: mehrere Tabellen in **FROM**, Verknüpfung über **WHERE** (PK=FK).
  2. „modern“: **INNER JOIN** (und Verknüpfungsbedingung mit **ON**).
     Beide liefern bei identischer Bedingung die gleiche Ergebnismenge. 
* **Beispielidee**: Länder in **Europa** aus **Land** und **Kontinent** (klassisch vs. **INNER JOIN**). **Drei-Tabellen-JOIN** analog (z. B. **Ort**–**Land**–**Kontinent**, zusätzlich **LIKE 'B%'**). 
* **JOIN-Varianten** (modern): **INNER**, **LEFT**, **RIGHT**, **FULL** – gleicher Syntaxrahmen, aber **unterschiedliche Ergebnismengen** (z. B. vollständige linke/rechte Tabelle). 

## ➕ Kombinieren von Ergebnismengen (UNION/UNION ALL)

* **UNION** vereint Ergebnismengen **zweier oder mehr** SELECTs; **Spaltentypen** müssen **kompatibel** sein; **Duplikate** werden **entfernt**.
* **UNION ALL** behält **Duplikate** (z. B. gleicher Name als **Land** und **Ort** erscheint doppelt). 

## 🔍 Unterabfragen (Subqueries)

* **Einsatz**: Einbetten einer Abfrage in **SELECT/WHERE** u. a., um deren **Ergebniswerte** in der Hauptabfrage zu verwenden. Beispiele:
  – **Vergleich mit Aggregat**: Orte mit **Einwohnerzahl > AVG(Einwohner)**.
  – **DELETE mit Subquery**: Orte eines bestimmten Landes löschen. 
* **Einzelwert- vs. Mehrwert-Subqueries**:
  – **Einzelwert** ⇒ Vergleichsoperatoren (=, >, ≥, <, ≤).
  – **Mehrwert** ⇒ **Mengenoperatoren** **IN**, **ANY**, **ALL**, **EXISTS** (Bedeutung siehe Tabelle unten). 
* **Regeln für Unterabfragen (Kurzfassung)**:

  1. **Runde Klammern** verwenden.
  2. **Vergleichsoperatoren** für **einen** Rückgabewert;
  3. **Mengenoperatoren** für **mehrere** Rückgabewerte;
  4. **ORDER BY** und **UNION** **nicht** in Unterabfragen. 

## 🛡️ Rechtevergabe (Benutzer & Privilegien)

* **CREATE USER** / **DROP USER** – Benutzer **anlegen** bzw. **löschen**.
* **GRANT** **[WITH GRANT OPTION]** – **Rechte** auf Objekte **erteilen** (mit Weitergaberecht).
* **REVOKE** – **Rechte entziehen**.
  Form und Beispiele werden explizit vorgegeben (z. B. **GRANT INSERT, UPDATE ON Ortsverwaltung.Ort TO …**). 

## 📘 Begriffsklärungen (kompakt)

* **INNER JOIN / LEFT JOIN / RIGHT JOIN / FULL JOIN**: Verknüpfen Tabellen über **ON**; unterscheiden sich in der **Vollständigkeit** der übernommenen Zeilen. 
* **UNION / UNION ALL**: **Zusammenführen** von Ergebnismengen; **UNION** entfernt Duplikate, **UNION ALL** nicht. 
* **Unterabfrage (Subquery)**: **Eingebettete Abfrage**, liefert **einen** oder **mehrere** Werte; wird z. B. in **WHERE** oder **SELECT** genutzt. 
* **Mengenoperatoren**: **IN** (Wert ist in Menge), **ANY** (Bedingung gilt für **mindestens einen** Wert), **ALL** (gilt für **alle** Werte), **EXISTS** (Unterabfrage liefert **mindestens einen Datensatz**). 
* **WITH GRANT OPTION**: Erlaubt dem Benutzer, **erhaltene Rechte weiterzugeben**. 

## 🎯 Ergebnis

Mit den erweiterten **SQL-Techniken** – robuste **JOINs**, **UNION/UNION ALL**, **Subqueries** inkl. **Mengenoperatoren** sowie **Benutzer- und Rechteverwaltung** – lassen sich anspruchsvolle **Abfragen** und eine **sichere Mehrbenutzersteuerung** in relationalen Systemen umsetzen. Das Kapitel liefert dafür **konkrete Syntax**, **Beispiele** und **Regeln**.
