# ðŸ”— 2.5.3 MQTT-Broker und Client verbinden [Seite: 135]

Ziel: Das **erweiterte CPS** wird als **MQTT-Client** mit einem **Broker** gekoppelt. Falls im Netzwerk noch kein Broker existiert, kann auf einem **Raspberry Pi** der Open-Source-Broker **Mosquitto** installiert werden. Der Broker **empfÃ¤ngt** Nachrichten (**Topics**) von Clients und **verteilt** die Inhalte an **abonniere**nde EmpfÃ¤nger (**Subscriber**); ohne Broker findet **keine Vermittlung** statt. Zur Kopplung von Hardware, Schnittstellen und Services sowie zur **Visualisierung (Dashboard)** eignet sich **Node-RED**.  

| **Begriff**                 | **Definition**                                                                                                         |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| **MQTT-Broker (Mosquitto)** | Serverinstanz, die **Publish/Subscribe**-Nachrichten vermittelt; auf **Raspberry Pi** leicht installierbar.            |
| **MQTT-Client**             | GerÃ¤t/Programm (z. B. **CPS/ESP32**), das **Topics** verÃ¶ffentlicht (**publish**) und/oder abonniert (**subscribe**).  |
| **Topic**                   | â€žThemaâ€œ/Kanal, Ã¼ber den Nachrichten adressiert werden (z. B. `esp32/temperature`).                                     |
| **Node-RED**                | Open-Source-Werkzeug mit **Nodes** (Eingabe/Verarbeitung/Ausgabe) zur Erstellung von **Flows** und **Dashboards**.     |

## ðŸ§­ Aufbau & Rolle der Komponenten

* **CPS/ESP32 â†’ Broker (publish):** Das CPS sendet Messwerte zu definierten **Topics** (z. B. `esp32/temperature`, `esp32/humidity`, `esp32/CO2`). 
* **Broker â†’ Subscriber (forward):** **Mosquitto** leitet die Nachrichteninhalte an alle **Subscriber** der betreffenden Topics weiter. 
* **Node-RED (subscribe & UI):** **Abonniert** die Topics, verarbeitet die Daten in **Flows** und **zeigt** sie auf einem **Dashboard** an. 

## ðŸ§© Kopplungsschritte (didaktische Kurzform)

1. **Broker bereitstellen:** Falls keiner vorhanden ist, **Mosquitto** auf **Raspberry Pi** installieren und im Netzwerk verfÃ¼gbar machen. 
2. **Topics festlegen:** Eindeutige **Topics** fÃ¼r die CPS-MessgrÃ¶ÃŸen definieren (Beispiele s. oben). 
3. **Client anbinden:** CPS/ESP32 so konfigurieren, dass Messwerte **periodisch verÃ¶ffentlicht** werden (**publish**). 
4. **Node-RED-Flow erstellen:** **Input-Nodes** (MQTT-Subscribe) â†’ **Processing-Nodes** â†’ **Output/Dashboard-Nodes** verbinden; Messwerte im **Dashboard** darstellen. 

## âœ… Ergebnis & Hinweis

* Durch die **Broker-Kopplung** werden CPS-Daten **verteilt** und kÃ¶nnen **in Echtzeit** von **Node-RED** abonniert und **visualisiert** werden. **Ohne Broker** ist keine Nachrichtenweiterleitung mÃ¶glich. 

---
